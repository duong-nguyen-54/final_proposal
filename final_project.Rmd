---
title: "Analysis"
author: "Danny Nguyen"
date: "2023-12-03"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(readxl)
library(rvest)

```

#### Data Import
```{r}
lowbirthweight <- read_csv("csv_NYC_lowbirthweight.csv")
pm2.5 <- read_csv("pm2.5_NY.csv")
demographic<- read_csv("NY_demographics.csv") #https://censusreporter.org/
health <- read_excel("chir_current_data.xlsx")

```

```{r}
lowbirthweight <- lowbirthweight %>% 
  janitor::clean_names()%>%
  select (region_county, average_births, percentage)%>%
  rename (county = "region_county")

  
pm2.5 <- pm2.5 %>% 
  janitor::clean_names()%>%
  separate(date, into = c("date", "month","year"), sep = "/")%>%
  mutate(month=month.abb[as.numeric(month)]) %>%
  select(county, month, year, daily_mean_pm2_5_concentration, units, site_latitude, site_longitude) %>% 
  group_by(county) %>% 
  summarize(mean_pm2.5 = mean(daily_mean_pm2_5_concentration))

demographic <- demographic %>% 
  janitor::clean_names()%>%
  select(county, age, female, white, income) %>% 
  mutate(white= white/100)

health <- health %>%
  janitor::clean_names()%>%
  select (geographic_area,indicator_title,topic_area,rate_percent,measurement) %>%
  filter( str_detect (geographic_area, " County")) %>% 
  mutate (county = str_replace (geographic_area, " County", "")) %>%
  select (county, everything()) %>%
  select (-geographic_area) %>%
  filter(topic_area == "Cancer Indicators" | topic_area == "Respiratory Disease Indicators" | topic_area == "Cardiovascular Disease Indicators" | topic_area == "Maternal and Infant Health Indicators")
  
cancer <- health %>% 
  filter (topic_area == "Cancer Indicators") %>% 
  filter (indicator_title == "All cancer incidence rate per 100,000") %>% 
  select (-c(indicator_title, topic_area, measurement)) %>% 
  rename (cancer_mortality_per_100k = "rate_percent")

resp <- health %>%
  filter (topic_area == "Respiratory Disease Indicators") %>%
  filter (indicator_title == "Asthma hospitalization rate per 10,000") %>% 
  select (-c(indicator_title, topic_area, measurement)) %>% 
  rename (asthma_hosp_rate_per_10k = "rate_percent")

cardio <- health %>%
  filter (topic_area == "Cardiovascular Disease Indicators") %>%
  filter (indicator_title == "Cardiovascular disease hospitalization rate per 10,000") %>% 
  select (-c(indicator_title, topic_area, measurement)) %>% 
  rename (cardio_hosp_rate_per_10k = "rate_percent")

maternal <- health %>%
  filter (topic_area == "Maternal and Infant Health Indicators") %>%
  filter (indicator_title == "Percentage of premature births with <37 weeks gestation") %>% 
  select (-c(indicator_title, topic_area, measurement)) %>% 
  rename (premature_percentage = "rate_percent")


```

#### merge data 
```{r}
health_merge <- maternal %>% 
  inner_join(cancer, by = "county") %>%
  inner_join(resp, by = "county") %>% 
  inner_join(cardio, by = "county") 

merge <- lowbirthweight %>% 
  inner_join(pm2.5, by = "county") %>%
  inner_join(health_merge, by = "county") %>% 
  inner_join(demographic, by = "county") 

merge <- merge %>% 
  select (county, mean_pm2.5, age, female, white, income, everything())%>%
  mutate(asthma_hosp_rate_per_10k = as.numeric(asthma_hosp_rate_per_10k))%>%
  mutate(cardio_hosp_rate_per_10k = as.numeric(cardio_hosp_rate_per_10k))
```

#### regression pm2.5 and low birth weight 
```{r}
lm_pm2.5_birthweight <- lm(percentage~mean_pm2.5 , data=merge)
summary(lm_pm2.5_birthweight)

lm_pm2.5_birthweight_adjusted <-lm(percentage~mean_pm2.5+white+income , data=merge)
summary(lm_pm2.5_birthweight_adjusted)
```

##### stepwise 
```{r}
step(lm_pm2.5_birthweight_adjusted, direction = 'both')

```

#### regression pm2.5 and premature birth
```{r}
lm_pm2.5_premature <- lm(premature_percentage ~ mean_pm2.5 , data=merge)
summary(lm_pm2.5_premature)

lm_pm2.5_premature_adjusted <-lm(premature_percentage ~ mean_pm2.5+white+income, data=merge)
summary(lm_pm2.5_premature_adjusted)
```

##### stepwise 
```{r}
step(lm_pm2.5_premature_adjusted, direction = 'both')
```

#### regression pm2.5 and cancer mortality
```{r}
lm_pm2.5_cancer <- lm(cancer_mortality_per_100k ~ mean_pm2.5 , data=merge)
summary(lm_pm2.5_cancer)

lm_pm2.5_cancer_adjusted <-lm(cancer_mortality_per_100k ~ mean_pm2.5+white+income+female+age, data=merge)
summary(lm_pm2.5_cancer_adjusted)
```

##### stepwise 
```{r}
step(lm_pm2.5_cancer_adjusted, direction = 'both')
```

#### regression pm2.5 and asthma hospitalization 
```{r}
lm_pm2.5_asthma <- lm(asthma_hosp_rate_per_10k ~ mean_pm2.5 , data=merge)
summary(lm_pm2.5_asthma)

lm_pm2.5_asthma_adjusted <-lm(asthma_hosp_rate_per_10k ~ mean_pm2.5+white+income+female+age, data=merge)
summary(lm_pm2.5_asthma_adjusted)
```

##### stepwise 
```{r}
step(lm_pm2.5_asthma_adjusted, direction = 'both')
```

#### regression pm2.5 and cardiovascular disease hospitalization
```{r}
lm_pm2.5_cardio <- lm(cardio_hosp_rate_per_10k ~ mean_pm2.5 , data=merge)
summary(lm_pm2.5_cardio)

lm_pm2.5_cardio_adjusted <-lm(cardio_hosp_rate_per_10k ~ mean_pm2.5+white+income+female+age, data=merge)
summary(lm_pm2.5_cardio_adjusted)
```

##### stepwise 
```{r}
step(lm_pm2.5_cardio_adjusted, direction = 'both')
```